# [Git submodules docs](https://git-scm.com/book/ru/v2/Инструменты-Git-Подмодули)

***
> ```root/$``` - команда выполняется в корне основного репозитории  
> ```submodule/$``` - команда выполняется в директории подмодуля
***

## Клонирование репозитория с подмодулями

- ### Репозиторий уже развёрнут, но подмодуля нет:

1) ```root/$ git pull origin <branch>```
2) ```submodule/$ git submodule init```
3) ```submodule/$ git submodule update```

> Шаги 2 и 3 могут быть объединены ```submodule/$ git submodule update --init```

- ### Репозиторий не был склонирован:

1) ```git clone <repo-url> --recurse-submodules```

***

## Работа с репозиторием с подмодулями

- ### Изменения коснулись только основного репозитория и не затронули подмодуль:

1) Обычный порядок в корне основного репозитория (add, commit, push)

- ### Изменения затронули подмодуль (независимо от наличия изменений в основном репо):

1) ```submodule/$ git add/commit/push```
2) ```root/$ git add <submodule dir>```
3) ```root/$ git commit/push```

> Сначала выполняется сохранение изменений подмодуля, в результате меняется верхний коммит и его хэш.
> Далее в корневом репозитории обновляется указатель на состояние подмодуля (хэш коммита предыдущего состояния
> заменяется на хэш текущего коммита)
***

## Подтягивание изменений в репозитории с подмодулями

### Изменения только в подмодуле (нужно подтянуть новые стили на прод):

1) ```submodule/$ git pull origin <branch>```
2) ```root/$ git add <submodule dir>```
3) ```root/$ git commit/push```

> Обновление репозитория подмодуля проводится обычным способом, но не ограничивается этим. Дополнительно нужно заменить
> указатель на состояние подмодуля в основном репозитории

### Изменения во всех репозиториях

1) ```root/$ git pull origin <branch>```
2) ```submodule/$ git submodule update```

> То же, что и при разворачивании подмодуля в склонированном репо, только без инициализации
> подмодуля (```submodule/$ git submodule init```)
***

## Добавление репозитория как подмодуля

> Пример приведён для местоположения в htdocs/assets

1) ```root/$ cd htdocs```
2) ```root/htdocs/$ git submodule add <repo-url> assets```
3) ```root/htdocs/assets/$ npm install/start/build```
4) Удалить ```/build``` из ```.gitignore``` подмодуля
5) Запушить ```build``` - ```root/htdocs/assets/$ git add/commit/push```
6) Добавить в ```root/htdocs/``` ```.htaccess``` файл из этого репозитория
7) ```root/$ git add <submodule dir> htdocs/.htaccess```
8) ```root/$ git commit/push```

***

> Общие замечания: 
> 1) IDE часто не видит изменений указателя состояния подмодуля в основном репозитории. Т.е. если в
> подмодуле сделаны коммиты, то интерфейс git-а в IDE не указывает изменения ```/htdocs/assets``` и не предлагает добавить
> его в коммит - надёжнее выполнить ```git add``` в консоли вручную
> 2) ```git submodule``` использует интерпретатор ```perl```. На хостинге **sprinthost** он, по умолчанию, отключён. Необходимо писать в ТП для включения